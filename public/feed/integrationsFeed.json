[
  {
    "id": "slack-hello-world",
    "name": "Slack - Hello World",
    "smallIcon": "/images/slack.svg",
    "largeIcon": "http://some.icon/large.ico",
    "version": "1.0.0",
    "description": "# Lorem Ipsum\n\nLorem ipsum dolor sit amet, id nec summo copiosae voluptaria, in per modo saperet accumsan.\n\n\nA simple <% global.consts.feed.name %> hello world example.\n",
    "tags": {
      "catalog": "slack,intro,popular"
    },
    "configuration": {
      "schema": {
        "type": "object",
        "properties": {
          "slackIntegration": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "minLength": 3
              }
            }
          },
          "slackConnector": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "minLength": 3
              }
            }
          },
          "ui": {
            "type": "object",
            "properties": {
              "toggle": {
                "type": "boolean",
                "description": "The \"toggle\" option renders boolean values as a toggle."
              }
            }
          }
        }
      },
      "uischema": {
        "type": "Group",
        "label": "Slack Connector Details",
        "elements": [
          {
            "type": "VerticalLayout",
            "elements": [
              {
                "type": "Control",
                "label": "Advanced configuration...",
                "scope": "#/properties/ui/properties/toggle",
                "options": {
                  "toggle": true
                }
              },
              {
                "type": "Control",
                "scope": "#/properties/slackIntegration/properties/id",
                "label": "Name",
                "rule": {
                  "effect": "SHOW",
                  "condition": {
                    "scope": "#/properties/ui/properties/toggle",
                    "schema": {
                      "const": true
                    }
                  }
                }
              },
              {
                "type": "Control",
                "scope": "#/properties/slackConnector/properties/id",
                "label": "Slack Connector name",
                "rule": {
                  "effect": "SHOW",
                  "condition": {
                    "scope": "#/properties/ui/properties/toggle",
                    "schema": {
                      "const": true
                    }
                  }
                }
              }
            ]
          }
        ]
      },
      "data": {
        "slackConnector": {
          "slackName": "slack-connector"
        }
      },
      "entities": {
        "slackConnector": {
          "entityType": "connector",
          "data": {
            "configuration": {
              "scope": "chat:write",
              "tokenUrl": "<%global.consts.endpoint%>/v2/account/<%global.consts.accountId%>/subscription/<%global.consts.subscriptionId%>/connector/<%this.id%>/proxy/slack/oauth/token",
              "authorizationUrl": "<%global.consts.endpoint%>/v2/account/<%global.consts.accountId%>/subscription/<%global.consts.subscriptionId%>/connector/<%this.id%>/proxy/slack/oauth/authorize",
              "clientId": "<%global.consts.random%>",
              "clientSecret": "<%global.consts.random%>",
              "refreshErrorLimit": 100000,
              "refreshInitialBackoff": 100000,
              "refreshWaitCountLimit": 100000,
              "refreshBackoffIncrement": 100000,
              "accessTokenExpirationBuffer": 500
            },
            "files": {
              "package.json": "{\n  \"scripts\": {\n    \"redeploy\": \"fuse connector rm <%this.name%> && yarn deploy\",\n    \"deploy\": \"fuse connector deploy <%this.name%> -d .\",\n    \"get\": \"fuse connector get <%this.name%> -d .\"\n  },\n  \"dependencies\": {\n    \"@fusebit-int/slack-connector\": \"^2.0.0\",\n    \"@fusebit-int/framework\": \"^3.0.0\"\n  }\n}\n"
            },
            "handler": "@fusebit-int/oauth-connector"
          },
          "id": "<%this.id%>",
          "tags": {}
        },
        "slackIntegration": {
          "entityType": "integration",
          "data": {
            "configuration": {},
            "files": {
              "package.json": "{\n  \"scripts\": {\n    \"deploy\": \"fuse integration deploy <% this.id %> -d .\",\n    \"get\": \"fuse integration get <% this.id %> -d .\"\n  },\n  \"dependencies\": {\n    \"@fusebit-int/framework\": \"^3.0.0\",\n    \"superagent\": \"^6.1.0\",\n    \"@fusebit-int/oauth-provider\": \"*\"\n  },\n  \"files\": [\"./integration.js\", \"README.md\"]\n}\n",
              "./integration.js": "const { Integration } = require('@fusebit-int/framework');\n\nconst integration = new Integration();\nconst router = integration.router;\n\n/**\n * Post a message to Slack\n */\nrouter.post('/api/:tenantId/sendMessage', integration.middleware.authorizeUser('instance:put'), async (ctx) => {\n  const slackClient = await integration.tenant.getSdkByTenant(ctx, 'slackConnector', ctx.params.tenantId);\n  const result = await slackClient.chat.postMessage({\n    text: 'Hello world from Fusebit!',\n    channel: 'your-channel-name-here',\n  });\n  ctx.body = result;\n});\n\n/**\n * List Slack users\n */\nrouter.get('/api/:tenantId/users', integration.middleware.authorizeUser('instance:get'), async (ctx) => {\n  const slackClient = await integration.tenant.getSdkByTenant(ctx, 'slackConnector', ctx.params.tenantId);\n  const result = await slackClient.users.identity();\n  ctx.body = result;\n});\n\nmodule.exports = integration;\n",
              "README.md": "# Lorem Ipsum\n\nLorem ipsum dolor sit amet, id nec summo copiosae voluptaria, in per modo saperet accumsan.\n\n\n\nA simple <% global.consts.feed.name %> hello world example.\n\n# Sign up for Fusebit Now!\n\nIf you want to sign up for Fusebit to simplify your integrations, go to\n[https://fusebit.io](https://fusebit.io) now!.\n\n\nOpen up your browser to <% global.consts.endpoint %>/v2/account/<% global.consts.accountId %>/subscription/<%\nglobal.consts.subscriptionId %>/integration/<% global.consts.integrationId %>/api/startup to\ntest the integration!\n\n\n"
            },
            "handler": "./integration",
            "components": [
              {
                "name": "slackConnector",
                "skip": false,
                "provider": "@fusebit-int/oauth-provider",
                "entityId": "<% global.entities.slackConnector.id %>",
                "dependsOn": [],
                "entityType": "connector"
              }
            ],
            "componentTags": {}
          },
          "id": "<% this.id %>",
          "tags": {}
        }
      }
    }
  }
]
